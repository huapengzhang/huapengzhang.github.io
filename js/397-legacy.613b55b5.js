"use strict";(self["webpackChunkharmony_transfer"]=self["webpackChunkharmony_transfer"]||[]).push([[397],{83397:function(e,a,t){t.r(a),t.d(a,{default:function(){return O}});t(27420);var l=t(11185),n=t(9424),o=(t(68156),t(44114),t(18111),t(7588),t(33110),t(58335),t(95976)),r=t(10160),u=t(12040),i=t(29746),v=t(86635),s=t(39053),d=t(51449),c=t(78588),p=t(95400),m=t(34568),g=t(86108),y=t(92369),T=t(53620),k={class:"top-info"},f={style:{color:"#fff","font-size":"20px"}},b={style:{color:"#fff"},class:"UncommonLabel"},L={class:"button-container"},h={class:"stats"},F={class:"stat-item"},S={class:"count"},D={class:"stat-item"},_={class:"amount"},C={class:"record-title"},P={class:"record-amount"},M={class:"button-container fixedBtn"},N={class:"pop-content"},A={class:"menuBtnList"},R={class:"scroll-box"},K={class:"pop-wrap"},w={class:"pop-btn"},x={__name:"AdvanceDetail",setup(e){var a,t,x,I,B,O,E,q,{state:J}=(0,d.Pj)(),{commit:U}=(0,d.Pj)(),H=(0,s.rd)(),W=(0,u.KR)({}),{appContext:z}=(0,o.nI)(),{$filters:X}=null===z||void 0===z||null===(a=z.config)||void 0===a?void 0:a.globalProperties;T.log("state:",J);var{$qzbankBridge:Y}=z.config.globalProperties,G=(0,o.EW)(()=>{var e;return null===(e=H.currentRoute.value.query)||void 0===e?void 0:e.homeSize}),j=(0,o.EW)(()=>{var e;return null===(e=H.currentRoute.value.query)||void 0===e?void 0:e.fromPage}),V=function(){(0,y.loadBundle)().then(()=>{var e=[".Uncommonlabel"];setTimeout(function(){(0,y.getUnCommonWordConfig)(function(a){new UncommonWordShow(e,a)})},500)})};(0,o.sV)(()=>{(0,o.dY)(()=>{V()})});var $=(0,u.KR)({});J.advanceTransfer.advanceDetailInfo&&($.value=J.advanceTransfer.advanceDetailInfo);var Q,Z=(0,u.KR)({}),ee=(0,u.KR)((null===(t=$.value)||void 0===t?void 0:t.PayeeBankName)||""),ae=(0,u.KR)("");(null===(x=$.value)||void 0===x?void 0:x.PayeeAcNo.length)>3&&(ae.value=" (尾号"+(null===(Q=$.value)||void 0===Q||null===(Q=Q.PayeeAcNo)||void 0===Q?void 0:Q.slice(-4))+")");var te=(0,u.KR)("");"O"==$.value.TimerFreq&&(te.value="仅一次 ");var le=(0,u.KR)("- -");if(void 0!=$.value.BeginDate&&""!=$.value.BeginDate&&void 0!=$.value.EndDate&&""!=$.value.EndDate){var ne="";void 0!=$.value.EndForeverFlag&&"1"==$.value.EndForeverFlag?(ne="长期有效",le.value=ne+" ("+$.value.BeginDate+" 至 "+$.value.EndDate+")"):le.value=$.value.BeginDate+" 至 "+$.value.EndDate}var oe=(0,u.KR)([{name:"收款方",title:null===(I=$.value)||void 0===I?void 0:I.PayeeAcName},{name:"收款银行",title:ee.value+" "+ae.value},{name:"预约日期",title:null===(B=$.value)||void 0===B?void 0:B.TransDate},{name:"转出日",title:te.value+(null===(O=$.value)||void 0===O?void 0:O.DisplayContext)},{name:"有效期",title:le},{name:"转出金额",title:"¥ "+X.formatAmount(null===(E=$.value)||void 0===E?void 0:E.Amount)},{name:"留言信息",title:null===(q=$.value)||void 0===q?void 0:q.AttachInfo}]),re=()=>{p.ak({RootJnlNo:$.value.JnlNo}).then(e=>{var a;Z.value=e,0==(null===(a=Z.value)||void 0===a?void 0:a.List.length)&&(ue.value=!0)})},ue=(0,u.KR)(!1),ie=()=>{ue.value=!ue.value},ve=e=>{if(0==e.JnlState){var a={module:"ebank_account",url:"",webType:"4",params:"transfer-detail?from=transfer&JnlNo="+e.RouterJnlNo};Y.sendNativeInstrution("linkToAd",a,()=>{})}},se=(0,u.KR)(""),de=(0,u.KR)(!1),ce=(0,u.KR)([]);if(void 0!=$.value.OperTypes&&""!=$.value.OperTypes){var pe=$.value.OperTypes.split(",");pe.forEach(e=>{var a=c.A.OperTypes[e];ce.value.push({name:a,operType:e})})}var me=()=>{de.value=!0},ge=e=>{if(se.value=e.operType,de.value=!1,U("advanceTransfer/setState",{key:"advanceManagerInfo",value:e}),"8"==e.operType){var a=(0,n.A)((0,n.A)({},$.value),{},{BankCode:$.value.UnionDeptId||"",DrecCode:$.value.PayeeClearBankId||"",LName:$.value.PayeeAddr,OperType:e.operType});""!=a.BankCode&&""!=a.DrecCode||(a.LName="");var t={};if("O"==a.TimerFreq&&void 0!=a.TimerRule&&12==a.TimerRule.length){var l=a.TimerRule,o=new Date(l.slice(0,4),l.slice(4,6),l.slice(6,8),l.slice(8,10),l.slice(10,12));t.BeginDate=o;var r="".concat(o.getFullYear(),"年").concat(String(o.getMonth()+1),"月").concat(String(o.getDate()),"日 ").concat(String(o.getHours()),"时").concat(String(o.getMinutes()),"分");t.BeginDateStr=r}else{if("O"!=a.TimerFreq&&(t.StartDateStr=a.BeginDate,t.StartDate=new Date(a.BeginDate),t.EndDateStr=a.EndDate,t.EndDate=new Date(a.EndDate)),"M"==a.TimerFreq){var u=t.StartDate,i=new Date(u.getFullYear(),u.getMonth()+1,String(a.Mdate).padStart(2,"0"),a.beginHour,a.beginMin);""!=(null===a||void 0===a?void 0:a.Mdate)&&void 0!=(null===a||void 0===a?void 0:a.Mdate)&&""!=(null===a||void 0===a?void 0:a.beginHour)&&void 0!=(null===a||void 0===a?void 0:a.beginHour)&&""!=(null===a||void 0===a?void 0:a.beginMin)&&void 0!=(null===a||void 0===a?void 0:a.beginMin)&&(t.TurnOutDate=i,t.TurnOutDateStr="每月"+a.Mdate+"号 "+Number(a.beginHour)+"时"+a.beginMin+"分")}if("W"!=a.TimerFreq&&"D"!=a.TimerFreq||""!=(null===a||void 0===a?void 0:a.beginHour)&&void 0!=(null===a||void 0===a?void 0:a.beginHour)&&""!=(null===a||void 0===a?void 0:a.beginMin)&&void 0!=(null===a||void 0===a?void 0:a.beginMin)&&(t.TurnOutDate=a.beginHour+":"+a.beginMin,t.TurnOutDateStr=Number(a.beginHour)+"时"+Number(a.beginMin)+"分"),"Y"==a.TimerFreq){var v=t.StartDate,s=new Date(v.getFullYear(),String(a.MTTimerFreqs).padStart(2,"0"),String(a.Mdate).padStart(2,"0"),a.beginHour,a.beginMin);""!=(null===a||void 0===a?void 0:a.Mdate)&&void 0!=(null===a||void 0===a?void 0:a.Mdate)&&""!=(null===a||void 0===a?void 0:a.beginHour)&&void 0!=(null===a||void 0===a?void 0:a.beginHour)&&""!=(null===a||void 0===a?void 0:a.beginMin)&&void 0!=(null===a||void 0===a?void 0:a.beginMin)&&""!=(null===a||void 0===a?void 0:a.MTTimerFreqs)&&void 0!=(null===a||void 0===a?void 0:a.MTTimerFreqs)&&(t.TurnOutDate=s,t.TurnOutDateStr="每年"+a.MTTimerFreqs+"月"+a.Mdate+"日 "+Number(a.beginHour)+"时"+a.beginMin+"分")}}U("advanceTransfer/setState",{key:"selectedArea",value:[{text:$.value.ProvinceName,value:$.value.ProvinceCode},{text:$.value.CityName,value:$.value.CityCode}]}),U("advanceTransfer/setState",{key:"advanceSelectInfos",value:(0,n.A)({},t)}),U("advanceTransfer/setState",{key:"payeeInfo",value:(0,n.A)({},a)});var d=$.value.TaskName,c="";return""!=J.advanceTransfer.iconDict[$.value.TaskName]&&void 0!=J.advanceTransfer.iconDict[$.value.TaskName]||(d="自定义",c=$.value.TaskName),U("advanceTransfer/setState",{key:"advanceSelectInfos",value:{taskName:d,customizeName:c}}),U("advanceTransfer/setState",{key:"advanceManagerSelect",value:$.value.JnlNo}),U("advanceTransfer/setState",{key:"inputAmount",value:a.Amount||""}),void H.push({path:"/AdvanceInput",query:{homeSize:1+Number(G.value),fromPage:j}})}_e(!0)},ye=()=>{De($.value.Amount)},Te=(0,u.KR)(""),ke=(0,u.KR)(""),fe=(0,u.KR)(""),be=(0,u.KR)(""),Le=(0,u.KR)({}),he=(0,u.KR)([]),Fe=(0,u.KR)(""),Se=(0,u.KR)(""),De=e=>{var a=(0,u.lW)(e);he.value=[];var t=(0,u.KR)([]);v.sendNativeInstrution("getUserAllData",{},e=>{var n=JSON.parse(e),o=null===n||void 0===n?void 0:n.netBankLoginInfo;Se.value=o.UserName,Le.value=o,Te.value=Le.value.AuthType,Fe.value=o.AuthType,ke.value=String(null===o||void 0===o?void 0:o.isBlueUkey),be.value=n.CertState,fe.value=n.SoftCertFlag,"0"!=se.value?("1"!=Fe.value&&"7"!=Fe.value||he.value.push({text:"手机短信",authType:"1"}),"true"!=ke.value||"3"!=Fe.value&&"7"!=Fe.value||he.value.push({text:"蓝牙UKey",authType:"3"}),"4"==Fe.value&&"1"==ke.value&&he.value.push({text:"手机短信+蓝牙UKey",authType:"4"})):("1"!=Fe.value&&"7"!=Fe.value||parseFloat(a.value)<=parseFloat(W.value.S_LimitPerTrs)&&parseFloat(a.value)<=parseFloat(W.value.S_LimitPerDay)&&parseFloat(a.value)<=parseFloat(W.value.S_LimitPerDayForLeave)&&t.value.push({text:"手机短信",authType:"1"}),"true"!=ke.value||"3"!=Fe.value&&"7"!=Fe.value||parseFloat(a.value)<parseFloat(W.value.C_LimitPerTrs)&&parseFloat(a.value)<parseFloat(W.value.C_LimitPerDay)&&parseFloat(a.value)<parseFloat(W.value.C_LimitPerDayForLeave)&&t.value.push({text:"蓝牙UKey",authType:"3"}),"0"==fe.value&&"0"==be.value&&parseFloat(a.value)<=parseFloat(W.value.MC_LimitPerTrs)&&parseFloat(a.value)<=parseFloat(W.value.MC_LimitPerDay)&&parseFloat(a.value)<=parseFloat(W.value.MC_LimitPerDayForLeave)&&t.value.push({text:"手机证书",authType:"sf"}),"4"==Fe.value&&"1"==ke.value&&-parseFloat(a.value)<=-parseFloat(W.value.C_LimitPerTrs)&&-parseFloat(a.value)<=-parseFloat(W.value.C_LimitPerDay)&&-parseFloat(a.value)<=-parseFloat(W.value.C_LimitPerDayForLeave)&&t.value.push({text:"手机短信+蓝牙UKey",authType:"4"}),t.value.length>0&&he.value.push(t.value[0])),0==he.value.length?l.A.confirm({title:"温馨提示",message:"您输入的转账金额已超过当前介质转账限额，请联系客服：40088-96312",showCancelButton:!1,confirmButtonText:"好的",confirmButtonColor:"#1989Fa"}).then(()=>{}):Ce()})},_e=e=>{Object.keys(W.value).length>0?e&&ye():m.apiUsrActLimitMngTotal({SearchType:"1"}).then(a=>{W.value=a,W.value.S_LimitPerTrs=W.value.S_LimitPerTrs||"50000",W.value.S_LimitPerDay=W.value.S_LimitPerDay||"50000",W.value.S_LimitPerDayForLeave=a.S_LimitPerDayForLeave,W.value.MC_LimitPerTrs=W.value.MC_LimitPerTrs||"500000",W.value.MC_LimitPerDay=W.value.MC_LimitPerDay||"500000",W.value.MC_LimitPerDayForLeave=a.MC_LimitPerDayForLeave,W.value.C_LimitPerTrs=W.value.C_LimitPerTrs||"500000",W.value.C_LimitPerDay=W.value.C_LimitPerDay||"500000",W.value.C_LimitPerDayForLeave=a.C_LimitPerDayForLeave,e&&ye()})},Ce=()=>{m.GenToken().then(e=>{var a=e._tokenName;v.sendNativeInstrution("callPwdKbd",{},e=>{var t=JSON.parse(e);null!==t&&void 0!==t&&t.cancelInput&&"true"==(null===t||void 0===t?void 0:t.cancelInput)||t.pwd&&t.pwdLength&&6==t.pwdLength&&Ne(t,a)})})},Pe=(0,u.KR)(""),Me=(0,u.KR)(!1),Ne=(e,a)=>{g.DR({TransactionId:"MobileBookTrsMgmt",TrsPassword:e.pwd,_tokenName:a,AcNo:$.value.AcNo}).then(e=>{Pe.value=null===e||void 0===e?void 0:e.PassId,he.value.length>1?Me.value=!0:Ae(he.value[0])})},Ae=e=>{var a={OperType:se.value,JnlNo:$.value.JnlNo.toString(),TransactionId:"MobileBookTrsMgmt",submitTransId:"MobileBookTrsMgmt.do",PassId:Pe.value,PayerAcName:Se.value,PayerAcNo:$.value.AcNo};"sf"==e.authType?a.CertType=e.authType:a.AuthType=e.authType,p.uV(a).then(e=>{U("advanceTransfer/setState",{key:"advanceManagerSelect",value:$.value.JnlNo}),H.push({path:"/AdvanceManagerUpload",query:{advanceReqData:JSON.stringify(a),confirmResData:JSON.stringify(e),fromPage:j.value,homeSize:1+Number(G.value)}})})};return(0,o.sV)(()=>{re()}),(e,a)=>{var t=(0,o.g2)("van-tag"),l=(0,o.g2)("van-cell"),n=(0,o.g2)("van-cell-group"),v=(0,o.g2)("van-icon"),s=(0,o.g2)("van-button"),d=(0,o.g2)("van-grid-item"),p=(0,o.g2)("van-grid"),m=(0,o.g2)("van-action-sheet"),g=(0,o.g2)("van-popup"),y=(0,o.g2)("content-box");return(0,o.uX)(),(0,o.Wv)(y,{class:"containers",title:"预约记录详情"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",null,[(0,o.Lk)("div",k,[(0,o.bF)(l,{border:!1,class:"top-cell",style:{"padding-top":"20px"}},{title:(0,o.k6)(()=>[(0,o.Lk)("span",f,(0,r.v_)($.value.TaskName),1)]),default:(0,o.k6)(()=>[(0,o.bF)(t,{color:"#e6f7ff","text-color":"#1989fa",style:{padding:"4px 12px","font-weight":"bold","border-radius":"5px"}},{default:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)((0,u.R1)(c.A).TimerState[$.value.TimerState]),1)]),_:1})]),_:1}),(0,o.bo)((0,o.bF)(n,{border:!1},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(oe.value,(e,a)=>((0,o.uX)(),(0,o.Wv)(l,{key:a,title:e.name,border:!1,class:"top-cell","title-style":"color:white"},{value:(0,o.k6)(()=>[(0,o.Lk)("span",b,(0,r.v_)(e.title),1)]),_:2},1032,["title"]))),128))]),_:1},512),[[i.aG,1==ue.value]]),(0,o.Lk)("div",L,[(0,o.bF)(s,{type:"primary",text:"",onClick:a[0]||(a[0]=e=>ie()),style:{"background-color":"transparent",border:"none"}},{default:(0,o.k6)(()=>[(0,o.bF)(v,{color:"white",size:"20",name:0==ue.value?"arrow-down":"arrow-up"},null,8,["name"])]),_:1})])]),(0,o.Lk)("div",h,[(0,o.Lk)("div",F,[a[4]||(a[4]=(0,o.Lk)("p",null,"成功转账次数",-1)),(0,o.Lk)("p",S,(0,r.v_)(Z.value.SuccCnt)+" 次",1)]),(0,o.Lk)("div",D,[a[5]||(a[5]=(0,o.Lk)("p",null,"累计转出金额",-1)),(0,o.Lk)("p",_," ¥ "+(0,r.v_)((0,u.R1)(X).formatAmount(Z.value.SuccAmt)),1)])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Z.value.List,(e,a)=>((0,o.uX)(),(0,o.Wv)(l,{key:a,class:"record-content",onClick:a=>ve(e)},{title:(0,o.k6)(()=>[(0,o.Lk)("div",C,(0,r.v_)(e.TransTime),1),(0,o.bF)(t,{type:"primary",color:(0,u.R1)(c.A).SubTimerStateColor[e.JnlState].bgColor,"text-color":(0,u.R1)(c.A).SubTimerStateColor[e.JnlState].textColor,class:"record-tag"},{default:(0,o.k6)(()=>[(0,o.Lk)("span",null,(0,r.v_)((0,u.R1)(c.A).SubTimerState[e.JnlState]),1)]),_:2},1032,["color","text-color"])]),default:(0,o.k6)(()=>[(0,o.Lk)("div",P," ¥ "+(0,r.v_)((0,u.R1)(X).formatAmount(e.Amount)),1),(0,o.bo)((0,o.bF)(v,{name:"arrow",size:"20"},null,512),[[i.aG,0==e.JnlState]])]),_:2},1032,["onClick"]))),128))]),(0,o.bo)((0,o.Lk)("div",M,[(0,o.bF)(s,{type:"primary",text:"管理",class:"add-button",onClick:a[1]||(a[1]=e=>me())})],512),[[i.aG,ce.value.length>0]]),(0,o.bF)(m,{show:de.value,"onUpdate:show":a[2]||(a[2]=e=>de.value=e),"cancel-text":"取消","close-on-click-action":""},{default:(0,o.k6)(()=>[(0,o.Lk)("div",N,[(0,o.Lk)("div",A,[(0,o.Lk)("div",R,[(0,o.bF)(p,{"column-num":"1","icon-size":"0"},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(ce.value,(e,a)=>((0,o.uX)(),(0,o.Wv)(d,{icon:"",key:a,onClick:a=>ge(e),style:{"--van-grid-item-icon-size":"0"}},{text:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)(e.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})])])])]),_:1},8,["show"]),(0,o.bF)(g,{show:Me.value,"onUpdate:show":a[3]||(a[3]=e=>Me.value=e),round:"",closeable:"","close-on-click-overlay":!1},{default:(0,o.k6)(()=>[(0,o.Lk)("div",K,[a[6]||(a[6]=(0,o.Lk)("div",{class:"pop-title"},"需先进行认证验证",-1)),a[7]||(a[7]=(0,o.Lk)("div",{class:"pop-subtitle"},"请选择认证方式",-1)),(0,o.Lk)("div",w,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(he.value,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.authType},[(0,o.bF)(s,{class:"pop-authBtn",plain:"",type:"primary",block:"",onClick:a=>Ae(e)},{default:(0,o.k6)(()=>[(0,o.eW)((0,r.v_)(e.text),1)]),_:2},1032,["onClick"])]))),128))])])]),_:1},8,["show"])]),_:1})}}},I=t(1169);const B=(0,I.A)(x,[["__scopeId","data-v-11e9b292"]]);var O=B}}]);