"use strict";(self["webpackChunkharmony_transfer"]=self["webpackChunkharmony_transfer"]||[]).push([[113],{64113:function(e,a,l){l.r(a),l.d(a,{default:function(){return E}});l(27420);var t=l(11185),v=l(9424),u=(l(68156),l(62953),l(44114),l(18111),l(7588),l(61701),l(33110),l(58335),l(95976)),r=l(29746),n=l(10160),i=l(12040),o=l(86635),s=l(39053),d=l(51449),c=l(95400),p=l(34568),m=l(86108),g=l(78588),T=l(53620),y={class:"list"},h={class:"content"},k=["onClick"],b={class:"padding10"},L={class:"publicBox"},f={class:"top-row"},F={class:"title-icon"},S=["src"],D={class:"taskName"},M={class:"bank"},_={class:"middle-row"},C={class:"name"},N={class:"amount"},P={class:"bottom-row"},R={class:"check-all-container"},K={class:"check-all-label"},A={class:"pop-wrap"},w={class:"pop-btn"},x={__name:"AdvanceManagerList",setup(e){var a,l,{state:x}=(0,d.Pj)(),{commit:I}=(0,d.Pj)(),B=(0,s.rd)(),E=(0,i.KR)({}),O=(0,i.KR)(!0),q=(0,i.KR)(!1),U=(0,i.KR)(""),H=(0,i.KR)(""),J=(0,i.KR)(""),W=(0,i.KR)(""),X=(0,i.KR)({}),V=(0,i.KR)(""),Y=(0,i.KR)(0),j=(0,i.KR)([]),z=(0,i.KR)(""),G=(0,u.EW)(()=>{var e;return null===(e=B.currentRoute.value.query)||void 0===e?void 0:e.homeSize}),$=(0,u.EW)(()=>{var e;return null===(e=B.currentRoute.value.query)||void 0===e?void 0:e.fromPage}),Q=(0,i.KR)(!1),Z=()=>{c.bF({}).then(e=>{"Y"==(null===e||void 0===e?void 0:e.AuthTypeCheck)&&(Q.value=!0)})},ee=(0,i.KR)(""),ae=()=>{o.sendNativeInstrution("getUserAllData",{},e=>{var a=JSON.parse(e),l=null===a||void 0===a?void 0:a.netBankLoginInfo;ee.value=l.UserName,X.value=l,U.value=X.value.AuthType,z.value=l.AuthType,H.value=String(null===l||void 0===l?void 0:l.isBlueUkey),W.value=a.CertState,J.value=a.SoftCertFlag,Z()})};ae();var le=(0,i.KR)({});x.advanceTransfer.advanceManagerInfo&&(le.value=x.advanceTransfer.advanceManagerInfo);var te,ve=(0,i.KR)("");null!==(a=le.value)&&void 0!==a&&a.name&&(null===(l=le.value)||void 0===l?void 0:l.name.length)>0&&(ve.value="可"+(null===(te=le.value)||void 0===te?void 0:te.name)+"记录列表");var ue=(0,i.KR)(""),re=(0,i.Kh)({}),ne=(0,i.KR)([]),ie=(0,i.KR)([]),oe=(0,i.KR)([]),se=(0,u.EW)(()=>{var e={};return ne.value.forEach(a=>{var l=a.AcNo;e[l]||(e[l]=[]),e[l].push(a)}),e}),de=(0,u.EW)(()=>{var e=[];return oe.value.forEach(a=>{e.push({acNo:a,list:se.value[a]})}),e});x.advanceTransfer.advanceManagerList&&(ne.value=x.advanceTransfer.advanceManagerList,oe.value=Object.keys(se.value),ie.value=de.value,1==ie.value.length&&(V.value=ie.value[0].acNo));var ce=(0,i.KR)([]);x.advanceTransfer.advanceManagerSelect;var pe=(0,i.KR)(!1),me=(0,i.KR)(!1),ge=e=>{var a,l;if(0==(null===(a=le.value)||void 0===a?void 0:a.supportMultiple))e.length>1&&(ce.value=[e[e.length-1]]);else if(""!=V.value){var t,v=null===(t=se.value)||void 0===t?void 0:t[V.value];Y.value=v.length,me.value=e.length>0&&e.length<Y.value,pe.value=e.length===Y.value}O.value=!((null===(l=ce.value)||void 0===l?void 0:l.length)>0)},Te=e=>{var a;e?(ce.value=null===(a=se.value)||void 0===a?void 0:a[V.value].map(e=>e.JnlNo),O.value=!1):me.value||(ce.value=[],O.value=!0);me.value=!1},ye=e=>{var a;V.value==e.acNo?(Te(!1),V.value=""):(ce.value=[],V.value=e.acNo,Y.value=null===(a=se.value)||void 0===a?void 0:a[V.value].length)},he=(e,a)=>{m.DR({TransactionId:"MobileBookTrsMgmt",TrsPassword:e.pwd,_tokenName:a,AcNo:V.value}).then(e=>{ue.value=null===e||void 0===e?void 0:e.PassId,j.value.length>1?q.value=!0:ke(j.value[0])})},ke=e=>{var a={OperType:le.value.operType,JnlNo:ce.value.join(",").toString(),TransactionId:"MobileBookTrsMgmt",submitTransId:"MobileBookTrsMgmt.do",PassId:ue.value,PayerAcName:ee.value,PayerAcNo:V.value};"sf"==e.authType?a.CertType=e.authType:a.AuthType=e.authType,c.uV(a).then(e=>{I("advanceTransfer/setState",{key:"advanceManagerSelect",value:ce.value}),T.log("req:",a),B.push({path:"/AdvanceManagerUpload",query:{advanceReqData:JSON.stringify(a),confirmResData:JSON.stringify(e),fromPage:$.value,homeSize:1+Number(G.value)}})})},be=()=>{if("8"==le.value.operType){for(var e of null===(a=se.value)||void 0===a?void 0:a[V.value]){var a;if(e.JnlNo==ce.value[0]){re=e;break}}var l=(0,v.A)((0,v.A)({},re),{},{BankCode:re.UnionDeptId,DrecCode:re.PayeeClearBankId,LName:re.PayeeAddr,OperType:le.value.operType}),t={};if("O"==l.TimerFreq&&void 0!=l.TimerRule&&12==l.TimerRule.length){var u=l.TimerRule,r=new Date(u.slice(0,4),u.slice(4,6),u.slice(6,8),u.slice(8,10),u.slice(10,12));t.BeginDate=r;var n="".concat(r.getFullYear(),"年").concat(String(r.getMonth()+1),"月").concat(String(r.getDate()),"日 ").concat(String(r.getHours()),"时").concat(String(r.getMinutes()),"分");t.BeginDateStr=n}else{if("O"!=l.TimerFreq&&(t.StartDateStr=l.BeginDate,t.StartDate=new Date(l.BeginDate),t.EndDateStr=l.EndDate,t.EndDate=new Date(l.EndDate)),"M"==l.TimerFreq){var i=t.StartDate;T.log("sDate:",i.getFullYear()),T.log("sDate:",i.getMonth());var o=new Date(i.getFullYear(),i.getMonth()+1,String(l.Mdate).padStart(2,"0"),l.beginHour,l.beginMin);""!=(null===l||void 0===l?void 0:l.Mdate)&&void 0!=(null===l||void 0===l?void 0:l.Mdate)&&""!=(null===l||void 0===l?void 0:l.beginHour)&&void 0!=(null===l||void 0===l?void 0:l.beginHour)&&""!=(null===l||void 0===l?void 0:l.beginMin)&&void 0!=(null===l||void 0===l?void 0:l.beginMin)&&(t.TurnOutDate=o,t.TurnOutDateStr="每月"+l.Mdate+"号 "+Number(l.beginHour)+"时"+l.beginMin+"分")}if("W"!=l.TimerFreq&&"D"!=l.TimerFreq||""!=(null===l||void 0===l?void 0:l.beginHour)&&void 0!=(null===l||void 0===l?void 0:l.beginHour)&&""!=(null===l||void 0===l?void 0:l.beginMin)&&void 0!=(null===l||void 0===l?void 0:l.beginMin)&&(t.TurnOutDate=l.beginHour+":"+l.beginMin,t.TurnOutDateStr=Number(l.beginHour)+"时"+Number(l.beginMin)+"分"),"Y"==l.TimerFreq){var s=t.StartDate,d=new Date(s.getFullYear(),String(l.MTTimerFreqs).padStart(2,"0"),String(l.Mdate).padStart(2,"0"),l.beginHour,l.beginMin);""!=(null===l||void 0===l?void 0:l.Mdate)&&void 0!=(null===l||void 0===l?void 0:l.Mdate)&&""!=(null===l||void 0===l?void 0:l.beginHour)&&void 0!=(null===l||void 0===l?void 0:l.beginHour)&&""!=(null===l||void 0===l?void 0:l.beginMin)&&void 0!=(null===l||void 0===l?void 0:l.beginMin)&&""!=(null===l||void 0===l?void 0:l.MTTimerFreqs)&&void 0!=(null===l||void 0===l?void 0:l.MTTimerFreqs)&&(t.TurnOutDate=d,t.TurnOutDateStr="每年"+l.MTTimerFreqs+"月"+l.Mdate+"日 "+Number(l.beginHour)+"时"+l.beginMin+"分")}}I("advanceTransfer/setState",{key:"selectedArea",value:[{text:re.ProvinceName,value:re.ProvinceCode},{text:re.CityName,value:re.CityCode}]}),I("advanceTransfer/setState",{key:"advanceSelectInfos",value:(0,v.A)({},t)}),I("advanceTransfer/setState",{key:"payeeInfo",value:(0,v.A)({},l)});var c=re.TaskName,p="";return""!=x.advanceTransfer.iconDict[re.TaskName]&&void 0!=x.advanceTransfer.iconDict[re.TaskName]||(c="自定义",p=re.TaskName),I("advanceTransfer/setState",{key:"advanceSelectInfos",value:{taskName:c,customizeName:p}}),I("advanceTransfer/setState",{key:"advanceManagerSelect",value:ce.value}),I("advanceTransfer/setState",{key:"inputAmount",value:l.Amount||""}),void B.push({path:"/AdvanceInput",query:{homeSize:1+Number(G.value),fromPage:$}})}for(var m of null===(g=se.value)||void 0===g?void 0:g[V.value]){var g;if(m.JnlNo==ce.value[0]){re=m;break}}Fe(!0)},Le=()=>{fe(re.Amount)},fe=e=>{var a=(0,i.lW)(e);j.value=[];var l=(0,i.KR)([]);o.sendNativeInstrution("getUserAllData",{},e=>{var v;JSON.parse(e);"0"!=(null===(v=le.value)||void 0===v?void 0:v.operType)?("1"!=z.value&&"7"!=z.value||j.value.push({text:"手机短信",authType:"1"}),"1"!=H.value||"3"!=z.value&&"7"!=z.value||j.value.push({text:"蓝牙UKey",authType:"3"}),"4"==z.value&&"1"==H.value&&j.value.push({text:"手机短信+蓝牙UKey",authType:"4"})):("1"!=z.value&&"7"!=z.value||parseFloat(a.value)<=parseFloat(E.value.S_LimitPerTrs)&&parseFloat(a.value)<=parseFloat(E.value.S_LimitPerDay)&&parseFloat(a.value)<=parseFloat(E.value.S_LimitPerDayForLeave)&&l.value.push({text:"手机短信",authType:"1"}),"1"!=H.value||"3"!=z.value&&"7"!=z.value||parseFloat(a.value)<parseFloat(E.value.C_LimitPerTrs)&&parseFloat(a.value)<parseFloat(E.value.C_LimitPerDay)&&parseFloat(a.value)<parseFloat(E.value.C_LimitPerDayForLeave)&&l.value.push({text:"蓝牙UKey",authType:"3"}),"0"==J.value&&"0"==W.value&&parseFloat(a.value)<=parseFloat(E.value.MC_LimitPerTrs)&&parseFloat(a.value)<=parseFloat(E.value.MC_LimitPerDay)&&parseFloat(a.value)<=parseFloat(E.value.MC_LimitPerDayForLeave)&&l.value.push({text:"手机证书",authType:"sf"}),"4"==z.value&&"1"==H.value&&-parseFloat(a.value)<=-parseFloat(E.value.C_LimitPerTrs)&&-parseFloat(a.value)<=-parseFloat(E.value.C_LimitPerDay)&&-parseFloat(a.value)<=-parseFloat(E.value.C_LimitPerDayForLeave)&&l.value.push({text:"手机短信+蓝牙UKey",authType:"4"}),l.value.length>0&&j.value.push(l.value[0])),0==j.value.length?t.A.confirm({title:"温馨提示",message:"您输入的转账金额已超过当前介质转账限额，请联系客服：40088-96312",showCancelButton:!1,confirmButtonText:"好的",confirmButtonColor:"#1989Fa"}).then(()=>{}):Se()})},Fe=e=>{Object.keys(E.value).length>0?e&&Le():p.apiUsrActLimitMngTotal({SearchType:"1"}).then(a=>{E.value=a,E.value.S_LimitPerTrs=E.value.S_LimitPerTrs||"50000",E.value.S_LimitPerDay=E.value.S_LimitPerDay||"50000",E.value.S_LimitPerDayForLeave=a.S_LimitPerDayForLeave,E.value.MC_LimitPerTrs=E.value.MC_LimitPerTrs||"500000",E.value.MC_LimitPerDay=E.value.MC_LimitPerDay||"500000",E.value.MC_LimitPerDayForLeave=a.MC_LimitPerDayForLeave,E.value.C_LimitPerTrs=E.value.C_LimitPerTrs||"500000",E.value.C_LimitPerDay=E.value.C_LimitPerDay||"500000",E.value.C_LimitPerDayForLeave=a.C_LimitPerDayForLeave,e&&Le()})},Se=()=>{p.GenToken().then(e=>{var a=e._tokenName;o.sendNativeInstrution("callPwdKbd",{},e=>{var l=JSON.parse(e);null!==l&&void 0!==l&&l.cancelInput&&"true"==(null===l||void 0===l?void 0:l.cancelInput)||l.pwd&&l.pwdLength&&6==l.pwdLength&&he(l,a)})})};return(e,a)=>{var l=(0,u.g2)("van-icon"),t=(0,u.g2)("van-checkbox"),v=(0,u.g2)("van-tag"),o=(0,u.g2)("van-card"),s=(0,u.g2)("van-checkbox-group"),d=(0,u.g2)("van-button"),c=(0,u.g2)("van-popup"),p=(0,u.g2)("content-box");return(0,u.uX)(),(0,u.Wv)(p,{class:"containers",title:ve.value},{default:(0,u.k6)(()=>[(0,u.Lk)("div",y,[(0,u.Lk)("div",h,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(ie.value,(d,c)=>{var p;return(0,u.uX)(),(0,u.CE)("div",{class:"card-item",key:c},[(0,u.Lk)("div",{class:"section",onClick:(0,r.D$)(e=>ye(d),["stop"])},[(0,u.bF)(l,{color:"gray",size:"20",name:V.value!=d.acNo?"arrow-down":"arrow-up",class:"padding10"},null,8,["name"]),(0,u.Lk)("span",b," 转出账户 (尾号 "+(0,n.v_)(null===(p=d.acNo)||void 0===p?void 0:p.slice(-4))+")",1)],8,k),(0,u.bo)((0,u.bF)(s,{modelValue:ce.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.value=e),onChange:ge},{default:(0,u.k6)(()=>[(0,u.Lk)("div",L,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(d.list,a=>((0,u.uX)(),(0,u.CE)("div",{class:"card-item",key:a.JnlNo},[(0,u.bF)(t,{name:a.JnlNo,value:a.JnlNo,class:"card-checkbox"},null,8,["name","value"]),(0,u.bF)(o,{class:"card-content"},{title:(0,u.k6)(()=>{var l;return[(0,u.Lk)("div",f,[(0,u.Lk)("div",F,[""!=a.icon?((0,u.uX)(),(0,u.CE)("img",{key:0,src:a.icon,style:{width:"20px",height:"20px"}},null,8,S)):(0,u.Q3)("",!0),(0,u.Lk)("span",D,(0,n.v_)(e.$filters.taskNameSlice(a.TaskName,4)),1)]),(0,u.Lk)("span",M,"转至"+(0,n.v_)(a.PayeeBankName)+"("+(0,n.v_)(null===(l=a.PayeeAcNo)||void 0===l?void 0:l.slice(-4))+")",1),(0,u.bF)(v,{class:"tag-icon",color:(0,i.R1)(g.A).TimerStateColor[a.TimerState].bgColor,"text-color":(0,i.R1)(g.A).TimerStateColor[a.TimerState].textColor},{default:(0,u.k6)(()=>[(0,u.eW)((0,n.v_)((0,i.R1)(g.A).TimerState[a.TimerState]),1)]),_:2},1032,["color","text-color"])])]}),desc:(0,u.k6)(()=>[(0,u.Lk)("div",_,[(0,u.Lk)("span",C,(0,n.v_)(a.PayeeAcName),1),(0,u.Lk)("span",N,"¥ "+(0,n.v_)(e.$filters.formatAmount(a.Amount)),1)])]),footer:(0,u.k6)(()=>[(0,u.Lk)("div",P,[(0,u.Lk)("span",null,"转出日："+(0,n.v_)(a.DisplayContext),1)])]),_:2},1024)]))),128))])]),_:2},1032,["modelValue"]),[[r.aG,V.value==d.acNo]])])}),128))])]),(0,u.Lk)("div",R,[(0,u.bo)((0,u.bF)(t,{modelValue:pe.value,"onUpdate:modelValue":a[1]||(a[1]=e=>pe.value=e),indeterminate:me.value,onChange:Te,class:"check-all-item",disabled:""==V.value},{default:(0,u.k6)(()=>[(0,u.Lk)("span",K,[a[4]||(a[4]=(0,u.eW)(" 全选 ",-1)),(0,u.bo)((0,u.Lk)("span",null,"(已选中"+(0,n.v_)(ce.value.length)+"/"+(0,n.v_)(Y.value)+"条)",513),[[r.aG,ce.value.length>0]])])]),_:1},8,["modelValue","indeterminate","disabled"]),[[r.aG,le.value.supportMultiple]]),(0,u.bF)(d,{type:"primary",disabled:O.value,text:le.value.name,class:"button-click",onClick:a[2]||(a[2]=e=>be())},null,8,["disabled","text"])]),(0,u.bF)(c,{show:q.value,"onUpdate:show":a[3]||(a[3]=e=>q.value=e),round:"",closeable:"","close-on-click-overlay":!1},{default:(0,u.k6)(()=>[(0,u.Lk)("div",A,[a[5]||(a[5]=(0,u.Lk)("div",{class:"pop-title"},"需先进行认证验证",-1)),a[6]||(a[6]=(0,u.Lk)("div",{class:"pop-subtitle"},"请选择认证方式",-1)),(0,u.Lk)("div",w,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(j.value,e=>((0,u.uX)(),(0,u.CE)("div",{key:e.authType},[(0,u.bF)(d,{class:"pop-authBtn",plain:"",type:"primary",block:"",onClick:a=>ke(e)},{default:(0,u.k6)(()=>[(0,u.eW)((0,n.v_)(e.text),1)]),_:2},1032,["onClick"])]))),128))])])]),_:1},8,["show"])]),_:1},8,["title"])}}},I=l(1169);const B=(0,I.A)(x,[["__scopeId","data-v-7277365e"]]);var E=B}}]);